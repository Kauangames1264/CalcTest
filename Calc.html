<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora PWA</title>
<meta name="theme-color" content="#202124">
<style>
  body {
    background: #202124;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    font-family: Arial, sans-serif;
  }
  .calc {
    background: #303134;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 0 10px #000;
    width: 280px;
  }
  #display {
    width: 100%;
    height: 60px;
    font-size: 28px;
    text-align: right;
    background: #171717;
    color: #fff;
    border: none;
    border-radius: 6px;
    margin-bottom: 10px;
    padding: 10px;
  }
  button {
    width: 60px;
    height: 60px;
    font-size: 22px;
    margin: 5px;
    border: none;
    border-radius: 8px;
    background: #5f6368;
    color: #fff;
    cursor: pointer;
  }
  button:hover { background: #787c80; }
  .equal {
    background: #1a73e8;
    height: 130px;
  }
  .equal:hover { background: #4285f4; }
  #installPrompt {
    position: fixed;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    background: #1a73e8;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 12px 18px;
    font-size: 16px;
    cursor: pointer;
    display: none;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }
</style>
<link rel="manifest" href="data:application/manifest+json,{ 
  &quot;name&quot;: &quot;Calculadora PWA&quot;, 
  &quot;short_name&quot;: &quot;CalcPWA&quot;, 
  &quot;start_url&quot;: &quot;.&quot;, 
  &quot;display&quot;: &quot;standalone&quot;, 
  &quot;background_color&quot;: &quot;#202124&quot;, 
  &quot;theme_color&quot;: &quot;#202124&quot;, 
  &quot;icons&quot;: [
    { &quot;src&quot;: &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAAF5JREFUaIHt0zEBAAAAwqD1T20KP6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8GcLAAAHMEszQAAAABJRU5ErkJggg==&quot;, &quot;sizes&quot;: &quot;192x192&quot;, &quot;type&quot;: &quot;image/png&quot; },
    { &quot;src&quot;: &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAFxJREFUeJztwTEBAAAAwqD1T20JT6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8EwMGAAEnJg6sAAAAAElFTkSuQmCC&quot;, &quot;sizes&quot;: &quot;512x512&quot;, &quot;type&quot;: &quot;image/png&quot; }
  ]}">
</head>
<body>
  <div class="calc">
    <input type="text" id="display" disabled>
    <div class="buttons">
      <button onclick="clearDisplay()">C</button>
      <button onclick="deleteLast()">⌫</button>
      <button onclick="append('/')">÷</button>
      <button onclick="append('*')">×</button>

      <button onclick="append('7')">7</button>
      <button onclick="append('8')">8</button>
      <button onclick="append('9')">9</button>
      <button onclick="append('-')">−</button>

      <button onclick="append('4')">4</button>
      <button onclick="append('5')">5</button>
      <button onclick="append('6')">6</button>
      <button onclick="append('+')">+</button>

      <button onclick="append('1')">1</button>
      <button onclick="append('2')">2</button>
      <button onclick="append('3')">3</button>
      <button class="equal" onclick="calculate()">=</button>

      <button onclick="append('0')">0</button>
      <button onclick="append('.')">.</button>
    </div>
  </div>

  <button id="installPrompt">Instalar Calculadora</button>

<script>
const display = document.getElementById("display");
function append(v){display.value+=v;}
function clearDisplay(){display.value="";}
function deleteLast(){display.value=display.value.slice(0,-1);}
function calculate(){try{display.value=eval(display.value);}catch{display.value="Erro";}}

// Service Worker em memória
const swCode = `
  const CACHE_NAME = 'calc-pwa-v2';
  const FILES = ['.'];
  self.addEventListener('install',e=>{
    e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(FILES)));
  });
  self.addEventListener('fetch',e=>{
    e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));
  });
`;
const blob = new Blob([swCode], {type:'text/javascript'});
const swURL = URL.createObjectURL(blob);
if ('serviceWorker' in navigator) navigator.serviceWorker.register(swURL);

// Forçar prompt de instalação
let deferredPrompt;
const installBtn = document.getElementById('installPrompt');
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'block';
});
installBtn.addEventListener('click', async () => {
  installBtn.style.display = 'none';
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    if (outcome === 'accepted') {
      alert('App instalado! Reabra pela tela inicial.');
    } else {
      alert('Instalação necessária para usar o app.');
      installBtn.style.display = 'block';
    }
  }
});

// Bloqueia uso direto no navegador
window.addEventListener('load',()=>{
  if(!window.matchMedia('(display-mode: standalone)').matches){
    alert('Para usar a Calculadora, instale o app na tela inicial.');
    setTimeout(()=>{location.reload();},5000);
  }
});
</script>
</body>
</html>
